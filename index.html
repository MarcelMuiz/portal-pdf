<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Visualizador de Relatório</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}
    .container{background:#fff;padding:2rem;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);width:100%;max-width:400px;text-align:center}
    .logo{font-size:2rem;color:#333;margin-bottom:1rem;font-weight:bold}
    .subtitle{color:#666;margin-bottom:2rem;font-size:.9rem}
    .form-group{margin-bottom:1.5rem;text-align:left}
    label{display:block;margin-bottom:.5rem;color:#333;font-weight:500}
    input[type=password]{width:100%;padding:.75rem;border:2px solid #ddd;border-radius:5px;font-size:1rem;transition:border-color .3s}
    input[type=password]:focus{outline:0;border-color:#667eea}
    .btn{width:100%;padding:.75rem;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:0;border-radius:5px;font-size:1rem;cursor:pointer;transition:transform .2s}
    .btn:hover{transform:translateY(-2px)}
    .error-message{color:#e74c3c;margin-top:1rem;font-size:.9rem;display:none}
    .pdf-container{display:none;position:fixed;inset:0;background:#333;z-index:1000}
    .pdf-header{background:#222;color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center}
    .close-btn{background:#e74c3c;color:#fff;border:0;padding:.5rem 1rem;border-radius:3px;cursor:pointer}
    .pdf-viewer{width:100%;height:calc(100% - 60px);border:0}
    @media (max-width:480px){.container{margin:1rem;padding:1.5rem}}
  </style>
</head>
<body>
  <div class="container" id="loginContainer">
    <div class="logo">🔒 Relatório Protegido</div>
    <div class="subtitle">Digite a senha para acessar o relatório</div>

    <form id="loginForm">
      <div class="form-group">
        <label for="password">Senha:</label>
        <input type="password" id="password" name="password" required autocomplete="current-password"/>
      </div>
      <button type="submit" class="btn">Acessar Relatório</button>
      <div class="error-message" id="errorMessage">Senha incorreta. Tente novamente.</div>
    </form>
  </div>

  <div class="pdf-container" id="pdfContainer">
    <div class="pdf-header">
      <h3>Relatório</h3>
      <button class="close-btn" onclick="closePDF()">Fechar</button>
    </div>
    <iframe class="pdf-viewer" id="pdfViewer"></iframe>
  </div>

  <script>
    // ===================== CONFIG =====================
    // Nome do PDF no seu repositório (mesma pasta do index.html).
    // Se você renomear para "relatorio.pdf", basta ajustar esta constante.
    const PDF_FILE = "DISSERT WILSON LEAL JUNIOR.pdf";

    // Hash SHA-256 da senha "123456"
    // (8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92)
    const HASH_SENHA = "8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92";
    // ================== FIM CONFIG ====================

    async function sha256Hex(txt){
      const enc = new TextEncoder().encode(txt);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const senha = document.getElementById('password').value || "";
      const errorMessage = document.getElementById('errorMessage');

      try {
        const h = await sha256Hex(senha);
        if (h === HASH_SENHA) {
          mostrarPDF();
        } else {
          errorMessage.style.display = 'block';
          document.getElementById('password').value = '';
          document.getElementById('password').focus();
          setTimeout(()=>{ errorMessage.style.display='none'; }, 3000);
        }
      } catch {
        errorMessage.textContent = "Erro ao validar senha.";
        errorMessage.style.display = 'block';
      }
    });

    function mostrarPDF(){
      const loginContainer = document.getElementById('loginContainer');
      const pdfContainer   = document.getElementById('pdfContainer');
      const pdfViewer      = document.getElementById('pdfViewer');

      // Cache buster para garantir a versão mais recente
      const ts = Date.now();
      const url = encodeURI(PDF_FILE) + "?v=" + ts;

      pdfViewer.src = url;
      loginContainer.style.display = 'none';
      pdfContainer.style.display   = 'block';
    }

    function closePDF(){
      document.getElementById('pdfContainer').style.display = 'none';
      document.getElementById('loginContainer').style.display = 'block';
      document.getElementById('password').value = '';
      document.getElementById('errorMessage').style.display = 'none';
      document.getElementById('password').focus();
    }

    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape' && document.getElementById('pdfContainer').style.display === 'block') {
        closePDF();
      }
    });

    window.addEventListener('load', ()=>{
      document.getElementById('password').focus();
    });
  </script>
</body>
</html>
